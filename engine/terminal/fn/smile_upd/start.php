<?session_start();if ($_SESSION['username'] == 'Alexey'){	$adv_smile = 'class="chat_sc chat_sc_js"';			$wsc = '';	$wsc_2 = '';	$wsc_main = '';//Основные	$wsc_food = '';//еда	$wsc_trollface = '';//trollface	$wsc_music = '';//music	$wsc_love = '';//love	$wsc_holiday = '';//holiday	$wsc_job = '';//job	$wsc_computer = '';//computer	$wsc_friends = '';//friends	$wsc_weapon = '';//weapon	$wsc_sport = '';//sport	$wsc_dance = '';//dance	$chd = 0;	$js_rpl = '';//Для Javascript обработка перед отправкой	$js_sml = 'var chat_sml=[];';//Для Javascript массив смайлов		start_gen('main');	start_gen('food');	start_gen('trollface');	start_gen('music');	start_gen('love');	start_gen('holiday');	start_gen('job');	start_gen('computer');	start_gen('friends');	start_gen('weapon');	start_gen('sport');	start_gen('dance');		$fopen_1=file($_SERVER['DOCUMENT_ROOT'].'/engine/include/chat/burn_message.php');	foreach($fopen_1 as $key_1=>$value_1)	{		if(substr_count($value_1,"//Smiles_Search_Generator"))//Которую нужно найти		{			// если нашли			array_splice($fopen_1, $key_1, 1, "//Smiles_Search_Generator\r\n");//Заменили			array_splice($fopen_1, $key_1+1, 1, $wsc."\r\n"); //Заменили строчку ниже		}		$f_1=fopen($_SERVER['DOCUMENT_ROOT'].'/engine/include/chat/burn_message.php', "w");//переписали файл		for($i_1=0;$i_1<count($fopen_1);$i_1++)		{			fwrite($f_1,$fopen_1[$i_1]);		}		fclose($f_1);	}	$fopen=file($_SERVER['DOCUMENT_ROOT'].'/engine/include/chat/check_message.php');	foreach($fopen as $key=>$value)	{		if(substr_count($value,"//Smiles_Search_Generator"))//Которую нужно найти		{			array_splice($fopen, $key, 1, "//Smiles_Search_Generator\r\n");//Заменили			array_splice($fopen, $key+1, 1, "\r\n"); //Заменили строчку ниже			array_splice($fopen, $key+1, 1, $wsc_2."\r\n"); //Заменили строчку ниже		}		$f=fopen($_SERVER['DOCUMENT_ROOT'].'/engine/include/chat/check_message.php', "w"); // переписали файл		for($i=0;$i<count($fopen);$i++)		{			fwrite($f,$fopen[$i]);		}		fclose($f);	}		$fopen=file($_SERVER['DOCUMENT_ROOT'].'/engine/java/scripts.js');	foreach($fopen as $key=>$value)	{		if(substr_count($value,"//chat_smile_rpl_generator"))//Которую нужно найти		{			array_splice($fopen, $key, 1, "//chat_smile_rpl_generator\r\n");//Заменили			array_splice($fopen, $key+1, 1, "\r\n"); //Заменили строчку ниже			array_splice($fopen, $key+1, 1, 'function smiles_replace(obj){ '.$js_rpl." return obj;}\r\n"); //Заменили строчку ниже			array_splice($fopen, $key+2, 1, $js_sml."\r\n"); //Заменили строчку ниже		}		$f=fopen($_SERVER['DOCUMENT_ROOT'].'/engine/java/scripts.js', "w"); // переписали файл		for($i=0;$i<count($fopen);$i++)		{			fwrite($f,$fopen[$i]);		}		fclose($f);	}					echo 'Успешно!';				}else exit('Нет прав доступа!');function write_wb($f, $c){$fw=fopen($f, 'wb');fwrite($fw, $c);fclose($fw);}function start_gen($dr){	global $chd, $wsc, $wsc_2, $js_rpl, $adv_smile, $js_sml;	$tmp_var=0;//Для того чтобы в первой строчке убрать запятую. построение массива... array(x,x,x,)	$js_sml.="chat_sml['".$dr."']=new Array(";		$pdh = opendir($_SERVER['DOCUMENT_ROOT'].'/engine/images/smile/'.$dr.'/'); //Сканирование основных	while ($picfile = readdir($pdh)): 	if ($picfile != '.' && $picfile != '..') 	{ 		$chd++;$tmp_var++;		$pfp = '/engine/images/smile/'.$dr.'/'.$picfile;		$wsc.='$message=str_replace(\'('.$picfile.')\',\' <img alt="" class="chat_sc" src="'.$pfp.'"/> \',$message);';//Для BurnMessage		$wsc_2.='$fp[$old]=str_replace(\' <img alt="" class="chat_sc" src="'.$pfp.'"/> \',\'<span id="chat_js_view_smile_'.$chd.'" class="cursor_pointer" onclick=chat_view_smile("'.$pfp.'","chat_js_view_smile_'.$chd.'")>[+]</span>\',$fp[$old]);';		$js_rpl.='obj=obj.replace(\'<img alt="" src="'.$pfp.'">\', "('.$picfile.')");obj=obj.replace(\'<IMG alt="" src="'.$pfp.'">\', "('.$picfile.')");';				if($tmp_var==1){$js_sml.='"'.$picfile.'"';}		else {$js_sml.=', "'.$picfile.'"';}			$drs.='<img alt=\'\' src=\''.$pfp.'\' '.$adv_smile.' onclick=\'onclick_smile(this)\'/>';	} 	endwhile; 	closedir($pdh);		$js_sml.=');';	write_wb($_SERVER['DOCUMENT_ROOT'].'/engine/images/smile_html/'.$dr.'.txt', $drs);}?>